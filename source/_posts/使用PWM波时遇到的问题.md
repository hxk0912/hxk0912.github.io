---
title: 使用PWM波时遇到的问题
date: 2019-10-30 22:46:06
categories: STM32底层
tags:
---

## 问题

输出pwm波时，想要停掉pwm，然后引用了HAL_TIM_PWM_Stop(&htim2,TIM_CHANNEL_2);这个程序，可是发现停掉之后输出一直是高电平。

## 原因

HAL_TIM_PWM_Stop(&htim2,TIM_CHANNEL_2);这个函数会操作TIMx_CCER（捕获/比较使能寄存器）寄存器的CCxE位，这个位置0时禁止输出，置1时正常输出。
但是PWM停止时并没有控制输出引脚的电平，所以输出引脚的电平是不确定的。

## 解决方案

因为GPIO复用为PWM输出后就不能使用Write函数来直接操作位了，网上也有很多解决方法是设置活动电平或者是停止TIM计时器（对于只停止某一个通道的PWM就不可以用），我最后使用的解决方法是将占空比置0，再停止PWM输出，但是这样解决下一次再次调用的时候一定要记得重新设置占空比。
