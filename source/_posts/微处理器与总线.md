---
title: 微处理器与总线
date: 2020-02-26 08:08:44
tags:
categories: 微机原理与接口技术
---

## 8086内部结构

![alt](http://m.qpic.cn/psc?/V11NehB63qJi50/9vuGDcz9AP*EJeMjs9i.nmeCHdj7WnYmD2HAWANj4.hiS8n0RL2Ms1nbtiM1n12J9cr5wQb.N3RmH2okoDXlRzcLegn*rAwFZRnJdMytI8s!/b&bo=ZQODAgAAAAADB8U!&rf=viewer_4)

执行部件EU (execution unit):

* 负责指令的译码、执行和数据的运算

总线接口部件BIU (bus interface unit):

* 管理CPU与系统总线的接口
* 负责CPU对存储器和外设进行访问

两个单元在大多数情况下独立操作，还可以并行执行，执行上一个命令同时读取下一个命令。

## 8086/8088寄存器组

* 8个通用寄存器
* 4个段寄存器
* 1个标志寄存器
* 1个指令指针寄存器

### 通用寄存器

* 数据寄存器:  AX   BX   CX   DX
* 变址寄存器:  SI    DI
* 指针寄存器:  BP   SP

4个数据寄存器还可以分成高8位和低8位2个独立的寄存器
8个通用8位寄存器
AX： AH   AL    BX： BH   BL
CX： CH   CL    DX： DH   DL

* AX-累加器（accumulator） 使用频度最高，用于算术、逻辑运算以及与外设传送信息等
8位累加器为AL
* BX-基址寄存器（base address register） 常用做存放存储器地址
* CX-计数器（counter） 作为循环和串操作等指令中的隐含计数器
* DX-数据寄存器（data register） 常用来存放双字长数据的高16位，或存放外设端口地址

16位变址寄存器SI和DI，常用于存储器变址寻址方式时提供地址

* SI   源地址寄存器（source index）
* DI  目的地址寄存器（destination index）

指针寄存器用于寻址内存堆栈内的数据

* SP    堆栈指针寄存器（stack Pointer） 指示堆栈段栈顶的位置（偏移地址）
* BP   基址指针寄存器（base pointer） 表示数据在堆栈段中的基地址

### 指令指针寄存器

IP 指令指针寄存器（instruction pointer）

* 指示主存储器指令的位置
* 随着指令的执行，IP将自动修改以指示下一条指令所在的存储器位置
* IP寄存器是一个专用寄存器

IP寄存器与CS段寄存器联合使用以确定下一条指令的存储单元地址

**程序中不能直接使用IP寄存器**

### 标志

标志（flag）用于反映指令执行结果或控制指令执行形式。

处理器的各种标志形成了1个16位的标志寄存器FLAGS（程序状态字PSW寄存器）。

* CF 进位标志 进位CF=1
* ZF 零标志   运算结果为0，ZF=1
* SF 符号标志 运算结果最高位为1，SF=1
* PF 奇偶标志 运算结果最低8位中“1”的个数为偶数，PF=1
* OF 溢出标志 算术运算结果有溢出，OF=1
* AF 辅助进位标志 运算时D3位有进位或借位时，AF=1
* DF 方向标志 用于串操作指令中，控制地址的变化方向。DF=0时，存储器地址自动增加。
* IF 中断允许标志 允许中断，IF=1。
* TF 陷阱标志 单步执行指令时，TF=1

### 段寄存器

* CS-代码段寄存器（code segment） 指明当前代码段的起始地址
* DS-数据段寄存器（data segment） 指明当前数据段的起始地址
* ES-附加段寄存器（extra segment） 指明当前附加段的起始地址
* SS-堆栈段寄存器（stack segment） 指明当前堆栈段的起始地址

## 存储器结构

每个存储单元都有一个编号，被称为存储器地址

每个存储单元存放一个字节的内容

0002H单元存放有一个数据34H，表达为	[0002H]＝34H

### 小端方式

多字节数据在存储器中占连续的多个字节存储单元存放时，低字节存入低地址，高字节存入高地址；

表达时，用它的低地址表示多字节数据占据的地址空间。

[0002H]＝1234H时 0002H存入34H，0003H存入12H

## 存储器的分段管理

### 段基地址和偏移地址

#### 段基地址

* 指明逻辑段在主存储器中的起始位置
* 必须是16的整数倍！ 
* 即：xxxx0H省略低4位0000B,段地址可用16位数据表示,因此，就能用16位段寄存器表达段基地址。

#### 偏移地址

* 指明存储器单元距离段起始位置的偏移量
* 每段不超过64KB,偏移地址也可用16位数据表示
* 也称有效地址EA（effective address）

### 物理地址和逻辑地址

#### 物理地址

PA 8086/8088的存储系统中，对应每个存储单元都有一个唯一的20位编号；范围：00000H ~ FFFFFH。

#### 逻辑地址

程序员编程时采用。

#### 转换

物理地址：12345H
逻辑地址：1234H：0005H

**一个物理地址可能对应很多个逻辑地址，但是逻辑地址的最低4位一定与物理地址最低4位相同。**

### 段寄存器 - 段寄存器

#### 代码段

代码段用来存放程序的指令序列

CS：存放代码段的段基地址
IP：指示下条指令的偏移地址

处理器利用CS:IP取得下一条要执行的指令

#### 数据段

数据段存放运行程序所用的数据

DS：存放数据段的段基地址
有效地址EA：存储器操作数的偏移地址

处理器利用DS:EA存取数据段中的数据

#### 附加段

附加段是附加的数据段，也保存数据

ES：存放附加段的段基地址
有效地址EA：存储器操作数的偏移地址

处理器利用ES:EA存取附加段中的数据

串操作指令将附加段作为其目的操作数的存放区域

#### 堆栈段

堆栈段确定堆栈所在的主存区域

SS：存放堆栈段的段基地址
SP：指示堆栈栈顶的偏移地址

处理器利用SS:SP操作堆栈顶的数据

### 段超越

没有指明时，一般的数据访问在DS段。默认的情况允许改变，需要使用段超越前缀。

* CS:代码段超越，使用代码段的数据
* SS: 堆栈段超越，使用堆栈段的数据
* DS: 数据段超越，使用数据段的数据
* ES: 附加段超越，使用附加段的数据

没有段超越的指令实例：
MOV AX,[2000H]  ;  AX←DS:[2000H]；
从默认的DS数据段取出数据

采用段超越前缀的指令实例：
MOV AX,ES:[2000H]; AX←ES:[2000H]；
从指定的ES附加段取出数据

![alt](http://m.qpic.cn/psc?/V11NehB63qJi50/9vuGDcz9AP*EJeMjs9i.ngrdm4OgDy0whWuuZKl0TKFeFTMWctYPHRsIjHrjw6vY9ePJOeyThCaEVi2el8DeIc2j8Z.k6HvGOc.rhmjw1Ps!/b&bo=WAPhAQAAAAADB5k!&rf=viewer_4)

